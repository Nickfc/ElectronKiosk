<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Game Library Viewer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 16px;
    }
    select {
      margin-right: 8px;
      padding: 4px;
    }
    .game-details {
      display: flex;
      gap: 20px;
      margin-top: 20px;
    }
    .cover-container, .screenshots-container {
      flex: 1;
    }
    .cover-container img,
    .screenshots-container img {
      max-width: 100%;
      display: block;
      margin-bottom: 10px;
    }
    .metadata-container {
      flex: 2;
    }
    .metadata-container h2 {
      margin-top: 0;
    }
    .metadata-field {
      margin: 5px 0;
    }
    .metadata-label {
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Game Library Viewer</h1>

  <div>
    <label for="consoleSelect">Select Console:</label>
    <select id="consoleSelect">
      <option value="">-- Choose a Console --</option>
      <!-- Populated by JS -->
    </select>

    <label for="gameSelect">Select Game:</label>
    <select id="gameSelect" disabled>
      <option value="">-- Choose a Game --</option>
      <!-- Populated by JS -->
    </select>
  </div>

  <div id="gameDetails" class="game-details" style="display: none;">
    <div class="cover-container">
      <h3>Cover Image</h3>
      <img id="coverImage" src="" alt="Cover" />
      
      <h3>Screenshots</h3>
      <div class="screenshots-container" id="screenshotsContainer">
        <!-- Screenshots appended here -->
      </div>
    </div>

    <div class="metadata-container">
      <h2 id="gameTitle"></h2>
      <p id="gameDescription"></p>

      <div class="metadata-field">
        <span class="metadata-label">Console:</span>
        <span id="gameConsole"></span>
      </div>

      <div class="metadata-field">
        <span class="metadata-label">Genre:</span>
        <span id="gameGenre"></span>
      </div>

      <div class="metadata-field">
        <span class="metadata-label">Developer:</span>
        <span id="gameDeveloper"></span>
      </div>

      <div class="metadata-field">
        <span class="metadata-label">Publisher:</span>
        <span id="gamePublisher"></span>
      </div>

      <div class="metadata-field">
        <span class="metadata-label">Players:</span>
        <span id="gamePlayers"></span>
      </div>

      <div class="metadata-field">
        <span class="metadata-label">Rating:</span>
        <span id="gameRating"></span>
      </div>

      <div class="metadata-field">
        <span class="metadata-label">Release Date:</span>
        <span id="gameReleaseDate"></span>
      </div>
      
      <div class="metadata-field">
        <span class="metadata-label">File Size (bytes):</span>
        <span id="gameFileSize"></span>
      </div>

      <!-- Add more fields as desired -->
    </div>
  </div>

  <script>
    const consoleSelect = document.getElementById('consoleSelect');
    const gameSelect = document.getElementById('gameSelect');
    const gameDetailsSection = document.getElementById('gameDetails');

    const coverImage = document.getElementById('coverImage');
    const screenshotsContainer = document.getElementById('screenshotsContainer');
    const gameTitleEl = document.getElementById('gameTitle');
    const gameConsoleEl = document.getElementById('gameConsole');
    const gameGenreEl = document.getElementById('gameGenre');
    const gameDeveloperEl = document.getElementById('gameDeveloper');
    const gamePublisherEl = document.getElementById('gamePublisher');
    const gamePlayersEl = document.getElementById('gamePlayers');
    const gameRatingEl = document.getElementById('gameRating');
    const gameReleaseDateEl = document.getElementById('gameReleaseDate');
    const gameFileSizeEl = document.getElementById('gameFileSize');
    const gameDescriptionEl = document.getElementById('gameDescription');

    let gameDataByConsole = {}; // { consoleName: [ gameObjects ] }

    // Step 1: Fetch the games_scanned.json file
    fetch('data/games_scanned.json')
      .then(response => {
        if (!response.ok) {
          throw new Error('Failed to load games_scanned.json');
        }
        return response.json();
      })
      .then(jsonData => {
        // The structure is { Games: [...] }
        const games = jsonData.Games || [];

        // Step 2: Group by console name
        games.forEach(game => {
          const consoleName = game.Console;
          if (!gameDataByConsole[consoleName]) {
            gameDataByConsole[consoleName] = [];
          }
          gameDataByConsole[consoleName].push(game);
        });

        // Step 3: Populate the console <select>
        const consoleNames = Object.keys(gameDataByConsole).sort();
        consoleNames.forEach(name => {
          const option = document.createElement('option');
          option.value = name;
          option.textContent = name;
          consoleSelect.appendChild(option);
        });
      })
      .catch(error => {
        console.error('Error loading JSON:', error);
      });

    // Step 4: When console changes, populate the game <select>
    consoleSelect.addEventListener('change', () => {
      const selectedConsole = consoleSelect.value;
      if (!selectedConsole) {
        gameSelect.disabled = true;
        gameSelect.innerHTML = '<option value="">-- Choose a Game --</option>';
        gameDetailsSection.style.display = 'none';
        return;
      }

      // Clear out old data
      gameSelect.innerHTML = '<option value="">-- Choose a Game --</option>';
      const gamesForConsole = gameDataByConsole[selectedConsole] || [];
      gamesForConsole.forEach((g, index) => {
        const option = document.createElement('option');
        option.value = index; // store index in array
        option.textContent = g.Title;
        gameSelect.appendChild(option);
      });

      gameSelect.disabled = false;
      gameDetailsSection.style.display = 'none';
    });

    // Step 5: When a game is selected, show the details
    gameSelect.addEventListener('change', () => {
      const selectedConsole = consoleSelect.value;
      const selectedIndex = gameSelect.value;
      if (!selectedConsole || selectedIndex === '') {
        gameDetailsSection.style.display = 'none';
        return;
      }

      const game = gameDataByConsole[selectedConsole][selectedIndex];
      if (!game) {
        gameDetailsSection.style.display = 'none';
        return;
      }

      // Fill in the data
      gameTitleEl.textContent = game.Title || '';
      gameConsoleEl.textContent = game.Console || '';
      gameGenreEl.textContent = game.Genre || '';
      gameDeveloperEl.textContent = game.Developer || '';
      gamePublisherEl.textContent = game.Publisher || '';
      gamePlayersEl.textContent = game.Players || '';
      gameRatingEl.textContent = game.Rating || '';
      gameReleaseDateEl.textContent = game.ReleaseDate || '';
      gameFileSizeEl.textContent = game.FileSize || '';
      gameDescriptionEl.textContent = game.Description || '';

      // Cover image
      if (game.CoverImage) {
        coverImage.src = game.CoverImage.replace(/\\/g, '/'); 
        coverImage.style.display = 'block';
      } else {
        coverImage.src = '';
        coverImage.style.display = 'none';
      }

      // Screenshots
      screenshotsContainer.innerHTML = '';
      if (Array.isArray(game.Screenshots) && game.Screenshots.length > 0) {
        game.Screenshots.forEach(screenshotPath => {
          const img = document.createElement('img');
          img.src = screenshotPath.replace(/\\/g, '/');
          screenshotsContainer.appendChild(img);
        });
      }

      gameDetailsSection.style.display = 'flex';
    });
  </script>
</body>
</html>
